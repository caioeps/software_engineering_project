//= require plugins/gmap.js
$(document).ready(function() {
  map = new GMaps({
    div: '#map',
    lat: -3.7572221,
    lng: -38.5356611,
    zoom: 13
  });

  var response = $.ajax({
    type: 'GET',
    url: '<%= Rails.application.routes.url_helpers.occurrences_url(format: :json) %>',
  }).done(function(data) {
    loadMarkersIntoMap(map, data);
  });

  map.addMarker({
  lat: -3.7572221,
  lng: -38.5356611,
    title: 'Assalto!'
  });
});

function loadMarkersIntoMap(map, occurrences) {
  var markers = [];
  console.log(occurrences);
  for(i = 0; i < occurrences.length; i++) {
    markers[i] = {
      lat: occurrences[i].latitude,
      lng: occurrences[i].longitude,
      title: 'Assalto!'
    }
  }

  map.addMarkers(markers);

  return occurrences;
}
